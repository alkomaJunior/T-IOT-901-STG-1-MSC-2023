/**********************************************************************************************************************/
/* INCLUSIONS                                                                                                         */
/**********************************************************************************************************************/

#include "tools/util.h"

/**********************************************************************************************************************/
/* MACROS AND PRIVATE CONSTANTS                                                                                       */
/**********************************************************************************************************************/


/**********************************************************************************************************************/
/* PRIVATE STRUCTURE, ENUMS AND VARIABLES                                                                                    */
/**********************************************************************************************************************/


/**********************************************************************************************************************/
/* PRIVATE FUNCTION PROTOTYPE                                                                                         */
/**********************************************************************************************************************/

[[noreturn]]static void loopTask(void *pvParameters);

/**********************************************************************************************************************/
/* PUBLIC FUNCTION PROTOTYPE                                                                                          */
/**********************************************************************************************************************/


/**********************************************************************************************************************/
/* PRIVATE FUNCTION CODE                                                                                              */
/**********************************************************************************************************************/

// The arduino task
[[noreturn]]static void loopTask(void *pvParameters)
{
    setup();
    for(;;) {
        micros(); //update overflow
        loop();
    }
}

/**********************************************************************************************************************/
/* PUBLIC FUNCTION CODE                                                                                               */
/**********************************************************************************************************************/

// The setup routine runs once when M5Stack starts up
void setup(){
    M5ez::begin();
}

// The loop routine runs over and over again forever
void loop() {
    M5ez::msgBox("M5ez minimal program", "Hello World !", "Settings");
    ezSettings::menu();
}


/**********************************************************************************************************************/
/* C CODE AS C++ BODY                                                                                                 */
/**********************************************************************************************************************/


extern "C"
{
    void app_main()
    {
        initArduino();
        xTaskCreatePinnedToCore(loopTask, "loopTask", 8192, nullptr, 1, nullptr, ARDUINO_RUNNING_CORE);
    }
}



/**********************************************************************************************************************/
/* END OF FILE                                                                                                        */
/**********************************************************************************************************************/